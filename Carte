#Télécharger les données sur https://github.com/bnosac/BelgiumMaps.StatBel (je ne pense pas que le code marchera si vous ne le faites pas) + télécharger dossier waterways
#télécharger les différents packages
#si vous n'arrivez pas à exécuter le code, juste prendre fichier mapv2 que j'ai créé et l'appeler dans le script (en écrivant simplement mapv2)
#ATTENTION pour lecture du fichier csv --> A ADAPTER SELON VOTRE PROPRE CHEMIN D'ACCES (FICHIER CSV A TELECHARGER)

install.packages(c("sp","sf","rgdal","ggplot2","st","tmap","leaflet"))


library(sp)
library(sf)
library(rgdal)
library(ggplot2)
library(st)
library(tmap)
library(leaflet)
library(raster)


#------------------------------------------------------------------------------
#Fabrication de la carte de Belgique

data('BE_ADMIN_BELGIUM')
belgique <- st_as_sf(BE_ADMIN_BELGIUM)
data("BE_ADMIN_PROVINCE")               #Ajoute province (1)
provinces <- st_as_sf(BE_ADMIN_PROVINCE) # convertion st à sf (pour utilisation de tmap)
data("BE_ADMIN_MUNTY")                   #Pour les communes (2)
communes <- st_as_sf(BE_ADMIN_MUNTY)

#------------------------------------------------------------------------------
#Cours d'eau
data("BE_OSM_WATERWAYS")
waterways <- st_as_sf(BE_OSM_WATERWAYS) #(3)

#-------------------------------------------------------------------------------
#map avec cours d'eau

mapv1 <- qtm(provinces) +qtm(communes, fill = "#FFFFFF") + qtm(waterways, lines.col = "#006699")  #addition de 1,2,3

#mapv1
                      #pour voir à quoi ressemble la carte normalement
#-------------------------------------------------------------------------------




#à définir selon le chemin d'accès qui mène au fichier
setwd("C:/Users/nabil/OneDrive/Bureau/Projet/")
cordinates <- read.csv(file = "C:/Users/nabil/OneDrive/Bureau/Projet/coordonnée.csv") #anciennes coordonnées pour afficher points sur carte
#print(cordinates)
df1 <- data.frame(col = cordinates$Couleur)
#print(df1)


#couleur des points
icons_list <- icons(iconUrl = ifelse(df1$col == "Rouge", 
                                     'https://www.clker.com/cliparts/z/G/t/d/x/o/google-maps-marker-for-residencelamontagne-md.png',
                                     ifelse(df1$col == "Orange", "http://www.clker.com/cliparts/U/9/x/u/V/b/orange-marker-black-border-md.png", 
                                            ifelse(df1$col == "Vert","http://www.clker.com/cliparts/F/w/l/C/e/W/map-marker-md.png",NA))),
                    iconWidth = cordinates$Width, iconHeight = cordinates$Heigth)
                    
                    
map1 <- tmap_leaflet(mapv1)%>% #implémentation sous forme intéractive
  addMiniMap(position = "bottomright",
             width = 150,
             height = 150,
             zoomAnimation = TRUE)%>% #mini map, nécessaire?
  addMarkers(lng = cordinates$Longitude, lat = cordinates$Latitude, label = cordinates$Comments, icon = icons_list) #ajoute les différents points du fichier
map1


#possibilité d'ajouter d'autres infos dans le fichier csv
ID <- readline("Qui êtes vous ? ") 
Latitude <- as.numeric(readline("Veuillez introduire la latitude des coordonnées GPS : "))
Longitude <- as.numeric(readline("Veuillez introduire la longitude des coordonnées GPS : "))
Couleur <- readline("Couleur pour le point souhaité (1er lettre en majuscule) : ")  #à voir comment changer les couleurs des points
Date <- readline("Date dee la découverte : ")
Comments <- readline("Ajouter un commentaire : ")
Heigth <- 20
Width <- 20 #taille du points


data <- data.frame(ID,Latitude,Longitude,Couleur,Heigth,Width)

write.table(data,
            "C:/Users/nabil/OneDrive/Bureau/Projet/coordonnée.csv",
            append = TRUE,
            quote = FALSE,
            sep = ",",
            row.names = FALSE,
            col.names = FALSE)


newcordinates <- read.csv(file = 'C:/Users/nabil/OneDrive/Bureau/Projet/coordonnée.csv') #actualise fichier 
#print(newcordinates)


#mapv2
df <- data.frame(col = newcordinates$Couleur)
#print(df)

icons_list <- icons(iconUrl = ifelse(df$col == "Rouge", 
                                     'https://www.clker.com/cliparts/z/G/t/d/x/o/google-maps-marker-for-residencelamontagne-md.png',
                                     ifelse(df$col == "Orange", "http://www.clker.com/cliparts/U/9/x/u/V/b/orange-marker-black-border-md.png", 
                                            ifelse(df$col == "Vert","http://www.clker.com/cliparts/F/w/l/C/e/W/map-marker-md.png",NA))),
                    iconWidth = newcordinates$Width, iconHeight = newcordinates$Heigth)


map2 <- tmap_leaflet(mapv1)%>% #implémentation sous forme intéractive
  
  addMiniMap(position = "bottomright",
             width = 150,
             height = 150,
             zoomAnimation = TRUE)%>% #mini map, nécessaire?
  addMarkers(lng = newcordinates$Longitude, lat =newcordinates$Latitude, icon = icons_list) #ajoute les différents points du fichier
map2
